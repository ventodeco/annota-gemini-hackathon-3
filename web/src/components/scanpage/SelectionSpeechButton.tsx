import { Button } from '@/components/ui/button'

type SelectionRect = {
  top: number
  left: number
  width: number
  height: number
}

interface SelectionSpeechButtonProps {
  selectionRect: SelectionRect | null
  isLoading: boolean
  isPlaying: boolean
  onClick: () => void
}

export function SelectionSpeechButton({
  selectionRect,
  isLoading,
  isPlaying,
  onClick,
}: SelectionSpeechButtonProps) {
  const top = selectionRect ? Math.max(12, selectionRect.top - 44) : 80
  const left = selectionRect
    ? Math.max(12, Math.min(window.innerWidth - 48, selectionRect.left + selectionRect.width - 36))
    : Math.max(12, window.innerWidth - 56)

  return (
    <Button
      type="button"
      onClick={onClick}
      className="fixed z-50 h-9 w-9 rounded-xl bg-[#0F172A] p-0 text-white shadow-lg hover:bg-[#1E293B]"
      style={{ top, left }}
      aria-label={isPlaying || isLoading ? 'Stop playback' : 'Play selected text'}
    >
      {isLoading ? (
        <div className="h-4 w-4 animate-spin rounded-full border-2 border-white border-t-transparent" />
      ) : (
        <svg width="19" height="15" viewBox="0 0 19 15" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M7.59766 0.00158745C7.72862 -0.00474105 7.86011 0.00783232 7.9873 0.0396734L8.17383 0.101197L8.35059 0.190064C8.46269 0.257366 8.56443 0.341315 8.65234 0.438111L8.77441 0.593384L8.87109 0.764283C8.95521 0.941904 8.99971 1.13743 9 1.33557V13.4987L8.98535 13.6959C8.95655 13.8905 8.88547 14.0778 8.77539 14.2428C8.62853 14.4629 8.41924 14.6346 8.1748 14.736C7.9304 14.8373 7.66086 14.8637 7.40137 14.8121C7.14183 14.7604 6.90283 14.6322 6.71582 14.4449L3.89746 11.6256L3.89551 11.6246C3.85678 11.5857 3.81049 11.5539 3.75977 11.5328C3.70893 11.5118 3.65365 11.5015 3.59863 11.5016H1.58301C1.16343 11.5015 0.760676 11.3343 0.463867 11.0377C0.167017 10.7409 9.24329e-05 10.3374 0 9.9176V4.9176C9.24097e-05 4.49781 0.167024 4.09531 0.463867 3.79846C0.760722 3.50161 1.1632 3.33468 1.58301 3.3346H3.59863C3.65365 3.33472 3.70893 3.3244 3.75977 3.30335C3.81062 3.28225 3.85669 3.2506 3.89551 3.21155L3.89746 3.2096L6.7168 0.391236L6.71777 0.390259C6.9048 0.203656 7.1432 0.0764633 7.40234 0.025025L7.59766 0.00158745ZM14.6895 1.58362C14.9823 1.291 15.4572 1.29096 15.75 1.58362C16.516 2.34963 17.1235 3.25956 17.5381 4.26038C17.9526 5.26116 18.166 6.33437 18.166 7.4176C18.166 8.50077 17.9526 9.5741 17.5381 10.5748C17.1235 11.5754 16.5158 12.4847 15.75 13.2506C15.4571 13.5435 14.9823 13.5435 14.6895 13.2506C14.3968 12.9577 14.3966 12.4829 14.6895 12.1901C15.316 11.5634 15.8132 10.8193 16.1523 10.0006C16.4914 9.18187 16.666 8.30378 16.666 7.4176C16.666 6.5313 16.4915 5.65246 16.1523 4.83362C15.8131 4.01499 15.3161 3.27075 14.6895 2.64417C14.3967 2.35126 14.3966 1.87646 14.6895 1.58362ZM4.95801 4.27112L4.95703 4.27014C4.77867 4.44913 4.56742 4.59233 4.33398 4.68909C4.10047 4.78582 3.84943 4.83403 3.59668 4.83362V4.8346H1.58301C1.56103 4.83468 1.53996 4.84347 1.52441 4.85901C1.50888 4.87455 1.50009 4.89563 1.5 4.9176V9.9176C1.50009 9.93958 1.50887 9.96163 1.52441 9.97717C1.53992 9.99242 1.56125 10.0015 1.58301 10.0016H3.59668C3.84943 10.0012 4.10047 10.0504 4.33398 10.1471C4.56714 10.2438 4.77883 10.3863 4.95703 10.5651L7.5 13.1071V1.72913L4.95801 4.27112ZM11.9658 4.31799C12.297 4.06958 12.767 4.13644 13.0156 4.46741C13.6539 5.31846 13.999 6.35378 13.999 7.4176C13.999 8.48142 13.6539 9.51674 13.0156 10.3678C12.767 10.6988 12.297 10.7656 11.9658 10.5172C11.635 10.2686 11.5681 9.7986 11.8164 9.46741C12.2598 8.87606 12.499 8.15674 12.499 7.4176C12.499 6.67847 12.2598 5.95915 11.8164 5.3678C11.5681 5.03661 11.635 4.56658 11.9658 4.31799Z" fill="#F8FAFC" />
        </svg>
      )}
    </Button>
  )
}
